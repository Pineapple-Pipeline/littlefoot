import{getStyle as t}from"@pacote/get-style";import{pixels as e}from"@pacote/pixels";import{throttle as n}from"@pacote/throttle";function o(t,e){t.classList.add(e)}function i(t,e){t.classList.remove(e)}function s(t,e){return t.classList.contains(e)}const r="littlefoot__tooltip";function l(e){const n=Number.parseFloat(t(e,"marginLeft")),o=e.offsetWidth-n;return(e.getBoundingClientRect().left+o/2)/window.innerWidth}function c(e,n,s){const[r,c]=function(e,n){const o=Number.parseInt(t(n,"marginTop"),10),i=2*o+n.offsetHeight,s=e.getBoundingClientRect().top+e.offsetHeight/2,r=window.innerHeight-s;return r>=i||r>=s?["below",r-o-15]:["above",s-o-15]}(n,e);if(s!==r){i(e,"is-"+s),o(e,"is-"+r);const t=100*l(n)+"%",c="above"===r?"100%":"0";e.style.transformOrigin=t+" "+c}return[r,c]}const a=t=>{let e,n,o,i,s=!1;t.addEventListener("mousedown",(r=>{s=!0,o=t.offsetLeft,i=t.offsetTop,e=r.clientX,n=r.clientY,t.classList.add("dragging")})),document.addEventListener("mousemove",(r=>{if(s){const s=r.clientX-e,l=r.clientY-n;t.style.left=`${o+s}px`,t.style.top=`${i+l}px`}})),document.addEventListener("mouseup",(()=>{s&&(s=!1,t.classList.remove("dragging"))}))},d="is-active",u="is-changing",f="is-scrollable";function m({id:n,button:m,content:p,host:v,popover:h,wrapper:g}){let b=0,y="above";const E=()=>document.body.contains(h);return{id:n,activate:n=>{var i;m.setAttribute("aria-expanded","true"),o(m,u),o(m,d),m.insertAdjacentElement("afterend",h),h.style.maxWidth=document.body.clientWidth+"px",h.style.left="0",h.style.top="0",i=p,b=Math.round(e(t(i,"maxHeight"),i)),null==n||n(h,m),a(h)},dismiss:t=>{m.setAttribute("aria-expanded","false"),o(m,u),i(m,d),i(h,d),null==t||t(h,m)},isActive:()=>s(m,d),isReady:()=>!s(m,u),ready:()=>{o(h,d),i(m,u)},remove:()=>{h.remove(),i(m,u)},reposition:()=>{if(E()){const[t,e]=c(h,m,y);y=t,p.style.maxHeight=Math.min(b,e)+"px",h.offsetHeight<p.scrollHeight?(o(h,f),p.setAttribute("tabindex","0")):(i(h,f),p.removeAttribute("tabindex"))}},resize:()=>{E()&&(h.style.left=function(e,n){const o=e.offsetWidth;return-l(n)*o+Number.parseInt(t(n,"marginLeft"),10)+n.offsetWidth/2}(p,m)+"px",g.style.maxWidth=p.offsetWidth+"px",function(t,e){const n=t.querySelector("."+r);n&&(n.style.left=100*l(e)+"%")}(h,m))},destroy:()=>v.remove()}}const p="is-fully-scrolled",v=t=>e=>{const n=e.currentTarget,s=-e.deltaY;s>0&&i(t,p),n&&s<=0&&s<n.clientHeight+n.scrollTop-n.scrollHeight&&o(t,p)};const h="littlefoot__content",g="littlefoot__wrapper",b="littlefoot--print",y=(...t)=>t.forEach((t=>o(t,b)));function E(t,e){return Array.from(t.querySelectorAll(e))}function w(t,e){return t.querySelector("."+e)||t.firstElementChild||t}function x(t){const e=document.createElement("div");e.innerHTML=t;const n=e.firstElementChild;return n.remove(),n}function A(t){return void 0!==t}function D(t){const e=t.parentElement,n=E(e,":scope > :not(."+b+")"),o=n.filter((t=>"HR"===t.tagName));n.length===o.length&&(y(...o.concat(e)),D(e))}function L(t,e){const n=t.parentElement;t.remove(),n&&n!==e&&!n.innerHTML.replace(/(\[\]|&nbsp;|\s)/g,"")&&L(n,e)}function T([t,e,n],o){const i=x(n.outerHTML);E(i,'[href$="#'+t+'"]').forEach((t=>L(t,i)));const s=i.innerHTML.trim();return[e,n,{id:String(o+1),number:o+1,reference:"lf-"+t,content:s.startsWith("<")?s:"<p>"+s+"</p>"}]}function H(t){return e=>t.replace(/<%=?\s*(\w+?)\s*%>/g,((t,n)=>{var o;return String(null!==(o=e[n])&&void 0!==o?o:"")}))}function S(t,e){const o=H(t),i=H(e);return([t,e])=>{const s=e.id,r=x('<span class="littlefoot">'+o(e)+"</span>"),l=r.firstElementChild;l.setAttribute("aria-expanded","false"),l.dataset.footnoteButton="",l.dataset.footnoteId=s;const c=x(i(e));c.dataset.footnotePopover="",c.dataset.footnoteId=s;const a=w(c,g),d=w(c,h);return function(t,e){t.addEventListener("wheel",n(v(e),16))}(d,c),t.insertAdjacentElement("beforebegin",r),{id:s,button:l,host:r,popover:c,content:d,wrapper:a}}}function O({allowDuplicates:t,anchorParentSelector:e,anchorPattern:n,buttonTemplate:o,contentTemplate:s,footnoteSelector:r,numberResetSelector:l,scope:c}){const a=function(t,e,n){return E(t,n+' a[href*="#"]').filter((t=>(t.href+t.rel).match(e)))}(document,n,c).map(function(t,e,n,o){const i=[];return s=>{var r;const l=s.href.split("#")[1];if(!l)return;const c=null===(r=E(t,"#"+window.CSS.escape(l)).find((t=>e||!i.includes(t))))||void 0===r?void 0:r.closest(o);if(!c)return;i.push(c);const a=s.closest(n)||s;return[a.id||s.id,a,c]}}(document,t,e,r)).filter(A).map(T).map(l?function(t){let e=0,n=null;return([o,i,s])=>{const r=o.closest(t);return e=n===r?e+1:1,n=r,[o,i,Object.assign(Object.assign({},s),{number:e})]}}(l):t=>t).map((([t,e,n])=>(y(t,e),D(e),[t,n]))).map(S(o,s)).map(m);return{footnotes:a,unmount(){a.forEach((t=>t.destroy())),E(document,"."+b).forEach((t=>i(t,b)))}}}const _="[data-footnote-id]",C=(t,e)=>t.target.closest(e),M=t=>null==t?void 0:t.dataset.footnoteId,R=t=>e=>{e.preventDefault();const n=C(e,_),o=M(n);o&&t(o)},W=document.addEventListener,k=window.addEventListener,j=(t,e,n,o)=>W(t,(t=>{const o=t.target;(null==o?void 0:o.closest(e))&&n.call(o,t)}),o);const z={activateDelay:100,activateOnHover:!1,allowDuplicates:!0,allowMultiple:!1,anchorParentSelector:"sup",anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,dismissDelay:100,dismissOnUnhover:!1,dismissOnDocumentTouch:!0,footnoteSelector:"li",hoverDelay:250,numberResetSelector:"",scope:"",contentTemplate:`<aside class="littlefoot__popover" id="fncontent:<% id %>"><div class="${g}"><div class="${h}"><% content %></div></div><div class="${r}"></div></aside>`,buttonTemplate:'<button class="littlefoot__button" id="<% reference %>" title="See Footnote <% number %>"><svg role="img" aria-labelledby="title-<% reference %>" viewbox="0 0 31 6" preserveAspectRatio="xMidYMid"><title id="title-<% reference %>">Footnote <% number %></title><circle r="3" cx="3" cy="3" fill="white"></circle><circle r="3" cx="15" cy="3" fill="white"></circle><circle r="3" cx="27" cy="3" fill="white"></circle></svg></button>'};function $(t={}){const e=Object.assign(Object.assign({},z),t),o=function({footnotes:t,unmount:e},n){let o;const i=t=>e=>{e.isReady()&&(e.dismiss(n.dismissCallback),setTimeout(e.remove,t))},s=e=>o=>{n.allowMultiple||t.filter((t=>t.id!==o.id)).forEach(i(n.dismissDelay)),o.isReady()&&(o.activate(n.activateCallback),o.reposition(),o.resize(),setTimeout(o.ready,e))},r=e=>n=>{const o=t.find((t=>t.id===n));o&&e(o)},l=()=>t.forEach(i(n.dismissDelay));return{activate:(t,e)=>r(s(e))(t),dismiss:(t,e)=>r(i(e))(t),dismissAll:l,touchOutside:()=>{n.dismissOnDocumentTouch&&l()},repositionAll:()=>t.forEach((t=>t.reposition())),resizeAll:()=>t.forEach((t=>t.resize())),toggle:r((t=>t.isActive()?i(n.dismissDelay)(t):s(n.activateDelay)(t))),hover:r((t=>{o=t.id,n.activateOnHover&&!t.isActive()&&s(n.hoverDelay)(t)})),unhover:r((e=>{e.id===o&&(o=null),n.dismissOnUnhover&&setTimeout((()=>t.filter((t=>t.id!==o)).forEach(i(n.dismissDelay))),n.hoverDelay)})),unmount:e}}(O(e),e),i=function(t){const e=e=>{const n=C(e,"[data-footnote-button]"),o=M(n);o?(e.preventDefault(),t.toggle(o)):C(e,"[data-footnote-popover]")||t.touchOutside()},o=n(t.repositionAll,16),i=n(t.resizeAll,16),s=R(t.hover),r=R(t.unhover),l=new AbortController,c={signal:l.signal};return W("touchend",e,c),W("click",e,c),W("keyup",(e=>{27!==e.keyCode&&"Escape"!==e.key&&"Esc"!==e.key||t.dismissAll()}),c),W("gestureend",o,c),k("scroll",o,c),k("resize",i,c),j("mouseover",_,s,c),j("mouseout",_,r,c),()=>{l.abort()}}(o);return{activate(t,n=e.activateDelay){o.activate(t,n)},dismiss(t,n=e.dismissDelay){void 0===t?o.dismissAll():o.dismiss(t,n)},unmount(){i(),o.unmount()},getSetting:t=>e[t],updateSetting(t,n){e[t]=n}}}export{$ as default,$ as littlefoot};
