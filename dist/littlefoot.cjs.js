"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@pacote/get-style"),e=require("@pacote/pixels"),n=require("@pacote/throttle"),r=function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)};function o(t,e){t.classList.add(e)}function i(t,e){t.classList.remove(e)}function u(t,e){return t.classList.contains(e)}"function"==typeof SuppressedError&&SuppressedError;var c="littlefoot__tooltip";function a(e){var n=Number.parseFloat(t.getStyle(e,"marginLeft")),r=e.offsetWidth-n;return(e.getBoundingClientRect().left+r/2)/window.innerWidth}function s(e,n,r){var u=function(e,n){var r=Number.parseInt(t.getStyle(n,"marginTop"),10),o=2*r+n.offsetHeight,i=e.getBoundingClientRect().top+e.offsetHeight/2,u=window.innerHeight-i;return u>=o||u>=i?["below",u-r-15]:["above",i-r-15]}(n,e),c=u[0],s=u[1];if(r!==c){i(e,"is-"+r),o(e,"is-"+c);var l=100*a(n)+"%",f="above"===c?"100%":"0";e.style.transformOrigin=l+" "+f}return[c,s]}var l=function(t){var e,n,r,o,i=!1;t.addEventListener("mousedown",(function(u){i=!0,r=t.offsetLeft,o=t.offsetTop,e=u.clientX,n=u.clientY,t.classList.add("dragging")})),document.addEventListener("mousemove",(function(u){if(i){var c=u.clientX-e,a=u.clientY-n;t.style.left="".concat(r+c,"px"),t.style.top="".concat(o+a,"px")}})),document.addEventListener("mouseup",(function(){i&&(i=!1,t.classList.remove("dragging"))}))},f="is-active",d="is-changing",v="is-scrollable";function p(n){var r=n.id,p=n.button,m=n.content,h=n.host,g=n.popover,y=n.wrapper,b=0,E="above",w=function(){return document.body.contains(g)};return{id:r,activate:function(n){var r;p.setAttribute("aria-expanded","true"),o(p,d),o(p,f),p.insertAdjacentElement("afterend",g),g.style.maxWidth=document.body.clientWidth+"px",g.style.left="0",g.style.top="0",r=m,b=Math.round(e.pixels(t.getStyle(r,"maxHeight"),r)),null==n||n(g,p),l(g)},dismiss:function(t){p.setAttribute("aria-expanded","false"),o(p,d),i(p,f),i(g,f),null==t||t(g,p)},isActive:function(){return u(p,f)},isReady:function(){return!u(p,d)},ready:function(){o(g,f),i(p,d)},remove:function(){g.remove(),i(p,d)},reposition:function(){if(w()){var t=s(g,p,E),e=t[0],n=t[1];E=e,m.style.maxHeight=Math.min(b,n)+"px",g.offsetHeight<m.scrollHeight?(o(g,v),m.setAttribute("tabindex","0")):(i(g,v),m.removeAttribute("tabindex"))}},resize:function(){w()&&(g.style.left=function(e,n){var r=e.offsetWidth;return-a(n)*r+Number.parseInt(t.getStyle(n,"marginLeft"),10)+n.offsetWidth/2}(m,p)+"px",y.style.maxWidth=m.offsetWidth+"px",function(t,e){var n=t.querySelector("."+c);n&&(n.style.left=100*a(e)+"%")}(g,p))},destroy:function(){return h.remove()}}}var m="is-fully-scrolled",h=function(t){return function(e){var n=e.currentTarget,r=-e.deltaY;r>0&&i(t,m),n&&r<=0&&r<n.clientHeight+n.scrollTop-n.scrollHeight&&o(t,m)}};var g="littlefoot__content",y="littlefoot__wrapper",b="littlefoot--print",E=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.forEach((function(t){return o(t,b)}))};function w(t,e){return Array.from(t.querySelectorAll(e))}function x(t,e){return t.querySelector("."+e)||t.firstElementChild||t}function S(t){var e=document.createElement("div");e.innerHTML=t;var n=e.firstElementChild;return n.remove(),n}function A(t){return void 0!==t}function D(t){var e=t.parentElement,n=w(e,":scope > :not(."+b+")"),r=n.filter((function(t){return"HR"===t.tagName}));n.length===r.length&&(E.apply(void 0,r.concat(e)),D(e))}function L(t,e){var n=t.parentElement;t.remove(),n&&n!==e&&!n.innerHTML.replace(/(\[\]|&nbsp;|\s)/g,"")&&L(n,e)}function T(t,e){var n=t[0],r=t[1],o=t[2],i=S(o.outerHTML);w(i,'[href$="#'+n+'"]').forEach((function(t){return L(t,i)}));var u=i.innerHTML.trim();return[r,o,{id:String(e+1),number:e+1,reference:"lf-"+n,content:u.startsWith("<")?u:"<p>"+u+"</p>"}]}function H(t){return function(e){return t.replace(/<%=?\s*(\w+?)\s*%>/g,(function(t,n){var r;return String(null!==(r=e[n])&&void 0!==r?r:"")}))}}function O(t,e){var r=H(t),o=H(e);return function(t){var e=t[0],i=t[1],u=i.id,c=S('<span class="littlefoot">'+r(i)+"</span>"),a=c.firstElementChild;a.setAttribute("aria-expanded","false"),a.dataset.footnoteButton="",a.dataset.footnoteId=u;var s=S(o(i));s.dataset.footnotePopover="",s.dataset.footnoteId=u;var l=x(s,y),f=x(s,g);return function(t,e){t.addEventListener("wheel",n.throttle(h(e),16))}(f,s),e.insertAdjacentElement("beforebegin",c),{id:u,button:a,host:c,popover:s,content:f,wrapper:l}}}function _(t){var e,n,o,u=t.allowDuplicates,c=t.anchorParentSelector,a=t.anchorPattern,s=t.buttonTemplate,l=t.contentTemplate,f=t.footnoteSelector,d=t.numberResetSelector,v=t.scope,m=function(t,e,n){return w(t,n+' a[href*="#"]').filter((function(t){return(t.href+t.rel).match(e)}))}(document,a,v).map(function(t,e,n,r){var o=[];return function(i){var u,c=i.href.split("#")[1];if(c){var a=null===(u=w(t,"#"+window.CSS.escape(c)).find((function(t){return e||!o.includes(t)})))||void 0===u?void 0:u.closest(r);if(a){o.push(a);var s=i.closest(n)||i;return[s.id||i.id,s,a]}}}}(document,u,c,f)).filter(A).map(T).map(d?(e=d,n=0,o=null,function(t){var i=t[0],u=t[1],c=t[2],a=i.closest(e);return n=o===a?n+1:1,o=a,[i,u,r(r({},c),{number:n})]}):function(t){return t}).map((function(t){var e=t[0],n=t[1],r=t[2];return E(e,n),D(n),[e,r]})).map(O(s,l)).map(p);return{footnotes:m,unmount:function(){m.forEach((function(t){return t.destroy()})),w(document,"."+b).forEach((function(t){return i(t,b)}))}}}var M="[data-footnote-id]",C=function(t,e){return t.target.closest(e)},R=function(t){return null==t?void 0:t.dataset.footnoteId},W=function(t){return function(e){e.preventDefault();var n=C(e,M),r=R(n);r&&t(r)}},k=document.addEventListener,P=window.addEventListener,q=function(t,e,n,r){return k(t,(function(t){var r=t.target;(null==r?void 0:r.closest(e))&&n.call(r,t)}),r)};var z={activateDelay:100,activateOnHover:!1,allowDuplicates:!0,allowMultiple:!1,anchorParentSelector:"sup",anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,dismissDelay:100,dismissOnUnhover:!1,dismissOnDocumentTouch:!0,footnoteSelector:"li",hoverDelay:250,numberResetSelector:"",scope:"",contentTemplate:'<aside class="littlefoot__popover" id="fncontent:<% id %>"><div class="'.concat(y,'"><div class="').concat(g,'"><% content %></div></div><div class="').concat(c,'"></div></aside>'),buttonTemplate:'<button class="littlefoot__button" id="<% reference %>" title="See Footnote <% number %>"><svg role="img" aria-labelledby="title-<% reference %>" viewbox="0 0 31 6" preserveAspectRatio="xMidYMid"><title id="title-<% reference %>">Footnote <% number %></title><circle r="3" cx="3" cy="3" fill="white"></circle><circle r="3" cx="15" cy="3" fill="white"></circle><circle r="3" cx="27" cy="3" fill="white"></circle></svg></button>'};function j(t){void 0===t&&(t={});var e=r(r({},z),t),o=function(t,e){var n,r=t.footnotes,o=t.unmount,i=function(t){return function(n){n.isReady()&&(n.dismiss(e.dismissCallback),setTimeout(n.remove,t))}},u=function(t){return function(n){e.allowMultiple||r.filter((function(t){return t.id!==n.id})).forEach(i(e.dismissDelay)),n.isReady()&&(n.activate(e.activateCallback),n.reposition(),n.resize(),setTimeout(n.ready,t))}},c=function(t){return function(e){var n=r.find((function(t){return t.id===e}));n&&t(n)}},a=function(){return r.forEach(i(e.dismissDelay))};return{activate:function(t,e){return c(u(e))(t)},dismiss:function(t,e){return c(i(e))(t)},dismissAll:a,touchOutside:function(){e.dismissOnDocumentTouch&&a()},repositionAll:function(){return r.forEach((function(t){return t.reposition()}))},resizeAll:function(){return r.forEach((function(t){return t.resize()}))},toggle:c((function(t){return t.isActive()?i(e.dismissDelay)(t):u(e.activateDelay)(t)})),hover:c((function(t){n=t.id,e.activateOnHover&&!t.isActive()&&u(e.hoverDelay)(t)})),unhover:c((function(t){t.id===n&&(n=null),e.dismissOnUnhover&&setTimeout((function(){return r.filter((function(t){return t.id!==n})).forEach(i(e.dismissDelay))}),e.hoverDelay)})),unmount:o}}(_(e),e),i=function(t){var e=function(e){var n=C(e,"[data-footnote-button]"),r=R(n);r?(e.preventDefault(),t.toggle(r)):C(e,"[data-footnote-popover]")||t.touchOutside()},r=n.throttle(t.repositionAll,16),o=n.throttle(t.resizeAll,16),i=W(t.hover),u=W(t.unhover),c=new AbortController,a={signal:c.signal};return k("touchend",e,a),k("click",e,a),k("keyup",(function(e){27!==e.keyCode&&"Escape"!==e.key&&"Esc"!==e.key||t.dismissAll()}),a),k("gestureend",r,a),P("scroll",r,a),P("resize",o,a),q("mouseover",M,i,a),q("mouseout",M,u,a),function(){c.abort()}}(o);return{activate:function(t,n){void 0===n&&(n=e.activateDelay),o.activate(t,n)},dismiss:function(t,n){void 0===n&&(n=e.dismissDelay),void 0===t?o.dismissAll():o.dismiss(t,n)},unmount:function(){i(),o.unmount()},getSetting:function(t){return e[t]},updateSetting:function(t,n){e[t]=n}}}exports.default=j,exports.littlefoot=j;
